{% extends "base.html" %}
{% from "macros/form.html" import select_field, text_field, date_field, price_field, scale_select %}

{% block title %}编辑机车模型 - 火车模型管理系统{% endblock %}

{% block content %}
<h1>编辑机车模型</h1>

<form id="locomotive-form" method="POST">
  <div class="form-row">
    {{ select_field('model_id', '型号', locomotive_models, required=true, value=locomotive.model_id, onchange='autoFillLocomotive()') }}
    {{ select_field('series_id', '系列', locomotive_series, value=locomotive.series_id, onchange='handleLocomotiveSeriesChange()') }}
    {{ select_field('power_type_id', '动力类型', power_types, value=locomotive.power_type_id) }}
    {{ select_field('depot_id', '机务段', depots, value=locomotive.depot_id) }}
    {{ scale_select(value=locomotive.scale) }}
    {{ select_field('brand_id', '品牌', brands, required=true, value=locomotive.brand_id) }}
  </div>

  <div class="form-row">
    {{ text_field('locomotive_number', '机车号', required=true, value=locomotive.locomotive_number) }}
    {{ text_field('decoder_number', '编号', value=locomotive.decoder_number) }}
    {{ text_field('plaque', '挂牌', value=locomotive.plaque) }}
    {{ text_field('color', '颜色', value=locomotive.color) }}
    {{ select_field('chip_interface_id', '芯片接口', chip_interfaces, value=locomotive.chip_interface_id) }}
    {{ select_field('chip_model_id', '芯片型号', chip_models, value=locomotive.chip_model_id) }}
  </div>

  <div class="form-row">
    {{ text_field('item_number', '货号', value=locomotive.item_number) }}
    {{ price_field(value=locomotive.price) }}
    {{ select_field('merchant_id', '购买商家', merchants, value=locomotive.merchant_id) }}
    {{ date_field('purchase_date', '购买日期', value=locomotive.purchase_date) }}
  </div>

  <button type="submit">保存</button>
  <a href="{{ url_for('locomotive.locomotive') }}" class="btn-cancel">取消</a>
</form>

{% if errors %}
<div class="error">
  {% for error in errors %}
  <p>{{ error }}</p>
  {% endfor %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  window.locomotiveSeriesData = [
    {% for series in locomotive_series %}
    { id: {{ series.id }}, name: '{{ series.name }}' }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
  window.locomotiveModelData = [
    {% for model in locomotive_models %}
    { id: {{ model.id }}, name: '{{ model.name }}', series_id: {{ model.series_id or 'null' }}, power_type_id: {{ model.power_type_id or 'null' }} }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
</script>
{% endblock %}
