{% extends "base.html" %}

{% block title %}é€‰é¡¹ç»´æŠ¤ - ç«è½¦æ¨¡å‹ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="page-header">
  <h1>é€‰é¡¹ç»´æŠ¤</h1>
  <button onclick="openImportDialog()" class="btn-import">ä»Excelå¯¼å…¥æ•°æ®</button>
  <button onclick="exportToExcel()" class="btn-export">å¯¼å‡ºæ•°æ®åˆ°Excel</button>
  <button onclick="openReinitDialog()" class="btn-danger-reinit">é‡æ–°åˆå§‹åŒ–æ•°æ®åº“</button>
</div>

<div class="option-groups">
  <!-- è´­ä¹°ä¿¡æ¯ -->
  <div class="option-group">
    <h3>è´­ä¹°ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('brands')" class="tab-btn">å“ç‰Œ</button>
      <button onclick="showTab('merchants')" class="tab-btn">å•†å®¶</button>
    </div>
  </div>

  <!-- é“è·¯ä¿¡æ¯ -->
  <div class="option-group">
    <h3>é“è·¯ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('power_types')" class="tab-btn active">åŠ¨åŠ›ç±»å‹</button>
      <button onclick="showTab('depots')" class="tab-btn">å±€æ®µ</button>
    </div>
  </div>

  <!-- èŠ¯ç‰‡ä¿¡æ¯ -->
  <div class="option-group">
    <h3>èŠ¯ç‰‡ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('chip_interfaces')" class="tab-btn">èŠ¯ç‰‡æ¥å£</button>
      <button onclick="showTab('chip_models')" class="tab-btn">èŠ¯ç‰‡å‹å·</button>
    </div>
  </div>

  <!-- æœºè½¦ä¿¡æ¯ -->
  <div class="option-group">
    <h3>æœºè½¦ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('locomotive_series')" class="tab-btn">æœºè½¦ç³»åˆ—</button>
      <button onclick="showTab('locomotive_models')" class="tab-btn">æœºè½¦å‹å·</button>
    </div>
  </div>

  <!-- è½¦å¢ä¿¡æ¯ -->
  <div class="option-group">
    <h3>è½¦å¢ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('carriage_series')" class="tab-btn">è½¦å¢ç³»åˆ—</button>
      <button onclick="showTab('carriage_models')" class="tab-btn">è½¦å¢å‹å·</button>
    </div>
  </div>

  <!-- åŠ¨è½¦ç»„ä¿¡æ¯ -->
  <div class="option-group">
    <h3>åŠ¨è½¦ç»„ä¿¡æ¯</h3>
    <div class="tab-group">
      <button onclick="showTab('trainset_series')" class="tab-btn">åŠ¨è½¦ç»„ç³»åˆ—</button>
      <button onclick="showTab('trainset_models')" class="tab-btn">åŠ¨è½¦ç»„å‹å·</button>
    </div>
  </div>
</div>

<!-- Excelå¯¼å…¥å¯¹è¯æ¡† -->
<div id="import-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ“Š ä»Excelå¯¼å…¥æ•°æ®</h3>
    </div>
    <div class="modal-body">
      <p>è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼Œå°†æ ¹æ®å·¥ä½œè¡¨åè‡ªåŠ¨å¯¼å…¥åˆ°å¯¹åº”çš„æ•°æ®è¡¨ï¼š</p>
      <ul class="import-info">
        <li><strong>æœºè½¦</strong> â†’ æœºè½¦æ¨¡å‹è¡¨</li>
        <li><strong>è½¦å¢</strong> â†’ è½¦å¢æ¨¡å‹è¡¨</li>
        <li><strong>åŠ¨è½¦ç»„</strong> â†’ åŠ¨è½¦ç»„æ¨¡å‹è¡¨</li>
        <li><strong>å…ˆå¤´è½¦</strong> â†’ å…ˆå¤´è½¦æ¨¡å‹è¡¨</li>
      </ul>
      <p>Excelåˆ—åå¿…é¡»ä¸ç³»ç»Ÿä¸­çš„å­—æ®µåå¯¹åº”ã€‚</p>

      <div class="import-step">
        <input type="file" id="import-file" accept=".xlsx,.xls" />
        <div class="modal-buttons">
          <button onclick="closeImportDialog()" class="btn-cancel">å–æ¶ˆ</button>
          <button onclick="importFromExcel()" class="btn-primary" id="import-btn">å¯¼å…¥</button>
        </div>
      </div>
      <div id="import-result" class="import-result" style="display:none;"></div>
    </div>
  </div>
</div>

<!-- é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ç¡®è®¤å¯¹è¯æ¡† -->
<div id="reinit-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>âš ï¸ å±é™©æ“ä½œç¡®è®¤</h3>
    </div>
    <div class="modal-body">
      <p class="warning-text">æ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰æ•°æ®å¹¶é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼</p>
      <p class="warning-text">æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·ç¡®è®¤æ˜¯å¦ç»§ç»­ï¼Ÿ</p>

      <div class="confirmation-step">
        <p>è¯·è¾“å…¥ <strong>yes</strong> ç»§ç»­</p>
        <input type="text" id="reinit-input" placeholder="è¯·è¾“å…¥ yes" oninput="checkReinitInput()">
        <div class="modal-buttons">
          <button onclick="closeReinitDialog()" class="btn-cancel">å–æ¶ˆ</button>
          <button onclick="proceedToFinalConfirmation()" class="btn-danger" id="reinit-confirm-btn" disabled>ç¡®è®¤</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Excelå¯¼å…¥å¯¹è¯æ¡† -->
<div id="import-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ğŸ“Š ä»Excelå¯¼å…¥æ•°æ®</h3>
    </div>
    <div class="modal-body">
      <p>è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼Œå°†æ ¹æ®å·¥ä½œè¡¨åè‡ªåŠ¨å¯¼å…¥åˆ°å¯¹åº”çš„æ•°æ®è¡¨ï¼š</p>
      <ul class="import-info">
        <li><strong>æœºè½¦</strong> â†’ æœºè½¦æ¨¡å‹è¡¨</li>
        <li><strong>è½¦å¢</strong> â†’ è½¦å¢æ¨¡å‹è¡¨</li>
        <li><strong>åŠ¨è½¦ç»„</strong> â†’ åŠ¨è½¦ç»„æ¨¡å‹è¡¨</li>
        <li><strong>å…ˆå¤´è½¦</strong> â†’ å…ˆå¤´è½¦æ¨¡å‹è¡¨</li>
      </ul>
      <p>Excelåˆ—åå¿…é¡»ä¸ç³»ç»Ÿä¸­çš„å­—æ®µåå¯¹åº”ã€‚</p>

      <div class="import-step">
        <input type="file" id="import-file" accept=".xlsx,.xls" />
        <div class="modal-buttons">
          <button onclick="closeImportDialog()" class="btn-cancel">å–æ¶ˆ</button>
          <button onclick="importFromExcel()" class="btn-primary" id="import-btn">å¯¼å…¥</button>
        </div>
      </div>
      <div id="import-result" class="import-result" style="display:none;"></div>
    </div>
  </div>
</div>

<div class="tabs-container">

<div id="power_types" class="tab-content">
  <h2>åŠ¨åŠ›ç±»å‹</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢åŠ¨åŠ›ç±»å‹" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for type in power_types %}
      <tr data-id="{{ type.id }}" data-type="power_type" data-fields="name">
        <td data-field="name">{{ type.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'power_type')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'power_type', {{ type.id }}, '{{ url_for('options.delete_power_type', id=type.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="brands" class="tab-content" style="display:none;">
  <h2>å“ç‰Œ</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢å“ç‰Œ" required>
    <input type="text" name="website" placeholder="å®˜ç½‘åœ°å€ï¼ˆå¯é€‰ï¼‰">
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>å®˜ç½‘</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for brand in brands %}
      <tr data-id="{{ brand.id }}" data-type="brand" data-fields="name,website">
        <td data-field="name">{{ brand.name }}</td>
        <td data-field="website">{{ brand.website or '' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'brand')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'brand', {{ brand.id }}, '{{ url_for('options.delete_brand', id=brand.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="merchants" class="tab-content" style="display:none;">
  <h2>å•†å®¶</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢å•†å®¶" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for merchant in merchants %}
      <tr data-id="{{ merchant.id }}" data-type="merchant" data-fields="name">
        <td data-field="name">{{ merchant.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'merchant')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'merchant', {{ merchant.id }}, '{{ url_for('options.delete_merchant', id=merchant.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="depots" class="tab-content" style="display:none;">
  <h2>è½¦è¾†æ®µ/æœºåŠ¡æ®µ</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢è½¦è¾†æ®µ" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for depot in depots %}
      <tr data-id="{{ depot.id }}" data-type="depot" data-fields="name">
        <td data-field="name">{{ depot.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'depot')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'depot', {{ depot.id }}, '{{ url_for('options.delete_depot', id=depot.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="chip_interfaces" class="tab-content" style="display:none;">
  <h2>èŠ¯ç‰‡æ¥å£</h2>
  <form method="POST" action="{{ url_for('options.add_chip_interface') }}" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢èŠ¯ç‰‡æ¥å£" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for interface in chip_interfaces %}
      <tr data-id="{{ interface.id }}" data-type="chip_interface" data-fields="name">
        <td data-field="name">{{ interface.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'chip_interface')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'chip_interface', {{ interface.id }}, '{{ url_for('options.delete_chip_interface', id=interface.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="chip_models" class="tab-content" style="display:none;">
  <h2>èŠ¯ç‰‡å‹å·</h2>
  <form method="POST" action="{{ url_for('options.add_chip_model') }}" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢èŠ¯ç‰‡å‹å·" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for model in chip_models %}
      <tr data-id="{{ model.id }}" data-type="chip_model" data-fields="name">
        <td data-field="name">{{ model.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'chip_model')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'chip_model', {{ model.id }}, '{{ url_for('options.delete_chip_model', id=model.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="locomotive_series" class="tab-content" style="display:none;">
  <h2>æœºè½¦ç³»åˆ—</h2>
  <form method="POST" action="{{ url_for('options.add_locomotive_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢æœºè½¦ç³»åˆ—" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for series in locomotive_series %}
      <tr data-id="{{ series.id }}" data-type="locomotive_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'locomotive_series')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'locomotive_series', {{ series.id }}, '{{ url_for('options.delete_locomotive_series', id=series.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="locomotive_models" class="tab-content" style="display:none;">
  <h2>æœºè½¦å‹å·</h2>
  <form method="POST" action="{{ url_for('options.add_locomotive_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="æœºè½¦å‹å·" required>
      <select name="series_id" required>
        <option value="">é€‰æ‹©ç³»åˆ—</option>
        {% for series in locomotive_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="power_type_id" required>
        <option value="">é€‰æ‹©åŠ¨åŠ›ç±»å‹</option>
        {% for type in power_types %}
        <option value="{{ type.id }}">{{ type.name }}</option>
        {% endfor %}
      </select>
      <button type="submit">æ·»åŠ </button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>ç³»åˆ—</th>
        <th>åŠ¨åŠ›ç±»å‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for model in locomotive_models %}
      <tr data-id="{{ model.id }}" data-type="locomotive_model" data-fields="name,series_id,power_type_id"
          data-series="{{ model.series_id or '' }}" data-power="{{ model.power_type_id or '' }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="power_type_id">{{ model.power_type.name if model.power_type else '-' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'locomotive_model')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'locomotive_model', {{ model.id }}, '{{ url_for('options.delete_locomotive_model', id=model.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="carriage_series" class="tab-content" style="display:none;">
  <h2>è½¦å¢ç³»åˆ—</h2>
  <form method="POST" action="{{ url_for('options.add_carriage_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢è½¦å¢ç³»åˆ—" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for series in carriage_series %}
      <tr data-id="{{ series.id }}" data-type="carriage_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'carriage_series')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'carriage_series', {{ series.id }}, '{{ url_for('options.delete_carriage_series', id=series.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="carriage_models" class="tab-content" style="display:none;">
  <h2>è½¦å¢å‹å·</h2>
  <form method="POST" action="{{ url_for('options.add_carriage_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="è½¦å¢å‹å·" required>
      <select name="series_id" required>
        <option value="">é€‰æ‹©ç³»åˆ—</option>
        {% for series in carriage_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="type" required>
        <option value="">é€‰æ‹©ç±»å‹</option>
        <option value="å®¢è½¦">å®¢è½¦</option>
        <option value="è´§è½¦">è´§è½¦</option>
        <option value="å·¥ç¨‹è½¦">å·¥ç¨‹è½¦</option>
      </select>
      <button type="submit">æ·»åŠ </button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>ç³»åˆ—</th>
        <th>ç±»å‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for model in carriage_models %}
      <tr data-id="{{ model.id }}" data-type="carriage_model" data-fields="name,series_id,type"
          data-series="{{ model.series_id or '' }}" data-carriage-type="{{ model.type }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="type">{{ model.type }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'carriage_model')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'carriage_model', {{ model.id }}, '{{ url_for('options.delete_carriage_model', id=model.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="trainset_series" class="tab-content" style="display:none;">
  <h2>åŠ¨è½¦ç»„ç³»åˆ—</h2>
  <form method="POST" action="{{ url_for('options.add_trainset_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="æ–°å¢åŠ¨è½¦ç»„ç³»åˆ—" required>
    <button type="submit">æ·»åŠ </button>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for series in trainset_series %}
      <tr data-id="{{ series.id }}" data-type="trainset_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'trainset_series')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'trainset_series', {{ series.id }}, '{{ url_for('options.delete_trainset_series', id=series.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="trainset_models" class="tab-content" style="display:none;">
  <h2>åŠ¨è½¦ç»„å‹å·</h2>
  <form method="POST" action="{{ url_for('options.add_trainset_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="åŠ¨è½¦ç»„å‹å·" required>
      <select name="series_id" required>
        <option value="">é€‰æ‹©ç³»åˆ—</option>
        {% for series in trainset_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="power_type_id" required>
        <option value="">é€‰æ‹©åŠ¨åŠ›ç±»å‹</option>
        {% for type in power_types %}
        <option value="{{ type.id }}">{{ type.name }}</option>
        {% endfor %}
      </select>
      <button type="submit">æ·»åŠ </button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>åç§°</th>
        <th>ç³»åˆ—</th>
        <th>åŠ¨åŠ›ç±»å‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for model in trainset_models %}
      <tr data-id="{{ model.id }}" data-type="trainset_model" data-fields="name,series_id,power_type_id"
          data-series="{{ model.series_id or '' }}" data-power="{{ model.power_type_id or '' }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="power_type_id">{{ model.power_type.name if model.power_type else '-' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">ç¼–è¾‘</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'trainset_model')" style="display:none;">ä¿å­˜</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">å–æ¶ˆ</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'trainset_model', {{ model.id }}, '{{ url_for('options.delete_trainset_model', id=model.id) }}')">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="/static/js/options.js"></script>

<style>
.tabs {
  margin-bottom:1rem;
}

/* é€‰é¡¹åˆ†ç»„æ ·å¼ */
.option-groups {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-bottom:2rem;
}

.option-group {
  flex: 1;
}

.option-group h3 {
  margin-bottom: 0.75rem;
  font-size: 1.125rem;
  color: #333;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e9ecef;
}

.tab-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

/* å±é™©æ“ä½œåŒºåŸŸæ ·å¼ */
.danger-zone {
  margin-top: 2rem;
  padding: 1.5rem;
  border: 2px solid #dc3545;
  border-radius: 8px;
  background-color: #fff5f5;
}

.danger-zone h3 {
  margin-bottom: 1rem;
  color: #dc3545;
  font-size: 1.25rem;
}

.warning-text {
  margin-bottom: 1rem;
  color: #721c24;
  font-weight: 500;
}

.btn-danger-reinit {
  padding: 0.75rem 1.5rem;
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1rem;
  transition: background-color 0.2s;
}

.btn-danger-reinit:hover {
  background-color: #b02a37;
}

.tabs-container {
  margin-top: 2rem;
}

.tab-btn {
  padding: 0.05rem 0.2rem;
  margin-right: 0.2rem;
  border: 2px solid #e9ecef;
  background-color: #f8f9fa;
  color: #495057;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
}

.tab-btn:hover {
  background-color: #e9ecef;
  border-color: #adb5bd;
}

.tab-btn.active {
  background-color: #0d6efd;
  color: white;
  border-color: #0a58ca;
  font-weight: 600;
}

.tab-content {
  padding: 1.5rem;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  background-color: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.tab-content h2 {
  margin-bottom: 1.25rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e9ecef;
}

.tab-content form {
  margin-bottom: 1.5rem;
}

.tab-content table {
  margin-top: 1rem;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .option-groups {
    gap: 0.75rem;
  }

  .option-group {
  min-width: 100%;
  }

  .tab-btn {
    text-align: center;
    padding: 0.05rem 0.2rem;
  }

  .tabs-container {
    margin-top: 1rem;
  }
}

@media (max-width: 480px) {
  .tab-btn {
    padding: 0.05rem 0.2rem;
  }
}

/* å¯¼å…¥å¯¹è¯æ¡†æ ·å¼ */
.import-info {
  background-color: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
  margin: 1rem 0;
  list-style-position: inside;
}

.import-step {
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid #dee2e6;
}

.import-step input[type="file"] {
  width: 100%;
  margin-bottom: 1rem;
}

.btn-primary {
  background-color: #0d6efd;
}

.btn-primary:hover {
  background-color: #0b5ed7;
}

.import-result {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 4px;
}

.import-result.success {
  background-color: #d4edda;
  color: #155724;
}

.import-result.error {
  background-color: #f8d7da;
  color: #721c24;
}

.import-result.loading {
  background-color: #cce5ff;
  color: #004085;
}
</style>
{% endblock %}
