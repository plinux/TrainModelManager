{% extends "base.html" %}

{% block title %}信息维护 - 火车模型管理系统{% endblock %}

{% block content %}
<div class="page-header">
  <h1>信息维护</h1>
</div>

<div class="option-groups">
  <!-- 购买信息 -->
  <div class="option-group">
    <h3>购买信息</h3>
    <div class="tab-group">
      <button onclick="showTab('brands')" class="tab-btn">品牌</button>
      <button onclick="showTab('merchants')" class="tab-btn">商家</button>
    </div>
  </div>

  <!-- 铁路信息 -->
  <div class="option-group">
    <h3>铁路信息</h3>
    <div class="tab-group">
      <button onclick="showTab('power_types')" class="tab-btn active">动力</button>
      <button onclick="showTab('depots')" class="tab-btn">局段</button>
    </div>
  </div>

  <!-- 芯片信息 -->
  <div class="option-group">
    <h3>芯片信息</h3>
    <div class="tab-group">
      <button onclick="showTab('chip_interfaces')" class="tab-btn">芯片接口</button>
      <button onclick="showTab('chip_models')" class="tab-btn">芯片型号</button>
    </div>
  </div>

  <!-- 机车信息 -->
  <div class="option-group">
    <h3>机车信息</h3>
    <div class="tab-group">
      <button onclick="showTab('locomotive_series')" class="tab-btn">机车系列</button>
      <button onclick="showTab('locomotive_models')" class="tab-btn">机车型号</button>
    </div>
  </div>

  <!-- 车厢信息 -->
  <div class="option-group">
    <h3>车厢信息</h3>
    <div class="tab-group">
      <button onclick="showTab('carriage_series')" class="tab-btn">车厢系列</button>
      <button onclick="showTab('carriage_models')" class="tab-btn">车厢型号</button>
    </div>
  </div>

  <!-- 动车组信息 -->
  <div class="option-group">
    <h3>动车组信息</h3>
    <div class="tab-group">
      <button onclick="showTab('trainset_series')" class="tab-btn">动车组系列</button>
      <button onclick="showTab('trainset_models')" class="tab-btn">动车组型号</button>
    </div>
  </div>
</div>

<div class="tabs-container">

<div id="power_types" class="tab-content">
  <h2>动力</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="新增动力" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for type in power_types %}
      <tr data-id="{{ type.id }}" data-type="power_type" data-fields="name">
        <td data-field="name">{{ type.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'power_type')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'power_type', {{ type.id }}, '{{ url_for('options.delete_power_type', id=type.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="brands" class="tab-content" style="display:none;">
  <h2>品牌</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="新增品牌" required>
    <input type="text" name="website" placeholder="官网地址（可选）">
    <input type="text" name="search_url" placeholder="搜索URL模板（可选）">
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>官网</th>
        <th>搜索URL</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for brand in brands %}
      <tr data-id="{{ brand.id }}" data-type="brand" data-fields="name,website,search_url">
        <td data-field="name">{{ brand.name }}</td>
        <td data-field="website">{{ brand.website or '' }}</td>
        <td data-field="search_url">{{ brand.search_url or '' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'brand')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'brand', {{ brand.id }}, '{{ url_for('options.delete_brand', id=brand.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="merchants" class="tab-content" style="display:none;">
  <h2>商家</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="新增商家" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for merchant in merchants %}
      <tr data-id="{{ merchant.id }}" data-type="merchant" data-fields="name">
        <td data-field="name">{{ merchant.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'merchant')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'merchant', {{ merchant.id }}, '{{ url_for('options.delete_merchant', id=merchant.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="depots" class="tab-content" style="display:none;">
  <h2>车辆段/机务段</h2>
  <form method="POST" class="inline-form">
    <input type="text" name="name" placeholder="新增车辆段" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for depot in depots %}
      <tr data-id="{{ depot.id }}" data-type="depot" data-fields="name">
        <td data-field="name">{{ depot.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'depot')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'depot', {{ depot.id }}, '{{ url_for('options.delete_depot', id=depot.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="chip_interfaces" class="tab-content" style="display:none;">
  <h2>芯片接口</h2>
  <form method="POST" action="{{ url_for('options.add_chip_interface') }}" class="inline-form">
    <input type="text" name="name" placeholder="新增芯片接口" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for interface in chip_interfaces %}
      <tr data-id="{{ interface.id }}" data-type="chip_interface" data-fields="name">
        <td data-field="name">{{ interface.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'chip_interface')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'chip_interface', {{ interface.id }}, '{{ url_for('options.delete_chip_interface', id=interface.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="chip_models" class="tab-content" style="display:none;">
  <h2>芯片型号</h2>
  <form method="POST" action="{{ url_for('options.add_chip_model') }}" class="inline-form">
    <input type="text" name="name" placeholder="新增芯片型号" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for model in chip_models %}
      <tr data-id="{{ model.id }}" data-type="chip_model" data-fields="name">
        <td data-field="name">{{ model.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'chip_model')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'chip_model', {{ model.id }}, '{{ url_for('options.delete_chip_model', id=model.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="locomotive_series" class="tab-content" style="display:none;">
  <h2>机车系列</h2>
  <form method="POST" action="{{ url_for('options.add_locomotive_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="新增机车系列" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for series in locomotive_series %}
      <tr data-id="{{ series.id }}" data-type="locomotive_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'locomotive_series')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'locomotive_series', {{ series.id }}, '{{ url_for('options.delete_locomotive_series', id=series.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="locomotive_models" class="tab-content" style="display:none;">
  <h2>机车型号</h2>
  <form method="POST" action="{{ url_for('options.add_locomotive_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="机车型号" required>
      <select name="series_id" required>
        <option value="">选择系列</option>
        {% for series in locomotive_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="power_type_id" required>
        <option value="">选择动力</option>
        {% for type in power_types %}
        <option value="{{ type.id }}">{{ type.name }}</option>
        {% endfor %}
      </select>
      <button type="submit">添加</button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>系列</th>
        <th>动力</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for model in locomotive_models %}
      <tr data-id="{{ model.id }}" data-type="locomotive_model" data-fields="name,series_id,power_type_id"
          data-series="{{ model.series_id or '' }}" data-power="{{ model.power_type_id or '' }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="power_type_id">{{ model.power_type.name if model.power_type else '-' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'locomotive_model')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'locomotive_model', {{ model.id }}, '{{ url_for('options.delete_locomotive_model', id=model.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="carriage_series" class="tab-content" style="display:none;">
  <h2>车厢系列</h2>
  <form method="POST" action="{{ url_for('options.add_carriage_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="新增车厢系列" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for series in carriage_series %}
      <tr data-id="{{ series.id }}" data-type="carriage_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'carriage_series')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'carriage_series', {{ series.id }}, '{{ url_for('options.delete_carriage_series', id=series.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="carriage_models" class="tab-content" style="display:none;">
  <h2>车厢型号</h2>
  <form method="POST" action="{{ url_for('options.add_carriage_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="车厢型号" required>
      <select name="series_id" required>
        <option value="">选择系列</option>
        {% for series in carriage_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="type" required>
        <option value="">选择类型</option>
        <option value="客车">客车</option>
        <option value="货车">货车</option>
        <option value="工程车">工程车</option>
      </select>
      <button type="submit">添加</button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>系列</th>
        <th>类型</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for model in carriage_models %}
      <tr data-id="{{ model.id }}" data-type="carriage_model" data-fields="name,series_id,type"
          data-series="{{ model.series_id or '' }}" data-carriage-type="{{ model.type }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="type">{{ model.type }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'carriage_model')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'carriage_model', {{ model.id }}, '{{ url_for('options.delete_carriage_model', id=model.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="trainset_series" class="tab-content" style="display:none;">
  <h2>动车组系列</h2>
  <form method="POST" action="{{ url_for('options.add_trainset_series') }}" class="inline-form">
    <input type="text" name="name" placeholder="新增动车组系列" required>
    <button type="submit">添加</button>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for series in trainset_series %}
      <tr data-id="{{ series.id }}" data-type="trainset_series" data-fields="name">
        <td data-field="name">{{ series.name }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'trainset_series')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'trainset_series', {{ series.id }}, '{{ url_for('options.delete_trainset_series', id=series.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="trainset_models" class="tab-content" style="display:none;">
  <h2>动车组型号</h2>
  <form method="POST" action="{{ url_for('options.add_trainset_model') }}">
    <div class="form-row">
      <input type="text" name="name" placeholder="动车组型号" required>
      <select name="series_id" required>
        <option value="">选择系列</option>
        {% for series in trainset_series %}
        <option value="{{ series.id }}">{{ series.name }}</option>
        {% endfor %}
      </select>
      <select name="power_type_id" required>
        <option value="">选择动力</option>
        {% for type in power_types %}
        <option value="{{ type.id }}">{{ type.name }}</option>
        {% endfor %}
      </select>
      <button type="submit">添加</button>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th>名称</th>
        <th>系列</th>
        <th>动力</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for model in trainset_models %}
      <tr data-id="{{ model.id }}" data-type="trainset_model" data-fields="name,series_id,power_type_id"
          data-series="{{ model.series_id or '' }}" data-power="{{ model.power_type_id or '' }}">
        <td data-field="name">{{ model.name }}</td>
        <td data-field="series_id">{{ model.series.name if model.series else '-' }}</td>
        <td data-field="power_type_id">{{ model.power_type.name if model.power_type else '-' }}</td>
        <td>
          <button type="button" class="btn-edit" onclick="editRow(this)">编辑</button>
          <button type="button" class="btn-save" onclick="saveRow(this, 'trainset_model')" style="display:none;">保存</button>
          <button type="button" class="btn-cancel" onclick="cancelEdit(this)" style="display:none;">取消</button>
          <button type="button" class="btn-danger" onclick="deleteItem(this, 'trainset_model', {{ model.id }}, '{{ url_for('options.delete_trainset_model', id=model.id) }}')">删除</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="/static/js/options.js"></script>

<style>
.tabs {
  margin-bottom:1rem;
}

/* 选项分组样式 */
.option-groups {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-bottom:2rem;
}

.option-group {
  flex: 1;
}

.option-group h3 {
  margin-bottom: 0.75rem;
  font-size: 1.125rem;
  color: #333;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e9ecef;
}

.tab-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

/* 危险操作区域样式 */
.danger-zone {
  margin-top: 2rem;
  padding: 1.5rem;
  border: 2px solid #dc3545;
  border-radius: 8px;
  background-color: #fff5f5;
}

.danger-zone h3 {
  margin-bottom: 1rem;
  color: #dc3545;
  font-size: 1.25rem;
}

.warning-text {
  margin-bottom: 1rem;
  color: #721c24;
  font-weight: 500;
}

.tabs-container {
  margin-top: 2rem;
}

.tab-btn {
  padding: 0.05rem 0.2rem;
  margin-right: 0.2rem;
  border: 2px solid #e9ecef;
  background-color: #f8f9fa;
  color: #495057;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
}

.tab-btn:hover {
  background-color: #e9ecef;
  border-color: #adb5bd;
}

.tab-btn.active {
  background-color: #0d6efd;
  color: white;
  border-color: #0a58ca;
  font-weight: 600;
}

.tab-content {
  padding: 1.5rem;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  background-color: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.tab-content h2 {
  margin-bottom: 1.25rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #e9ecef;
}

.tab-content form {
  margin-bottom: 1.5rem;
}

.tab-content table {
  margin-top: 1rem;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .option-groups {
    gap: 0.75rem;
  }

  .option-group {
  min-width: 100%;
  }

  .tab-btn {
    text-align: center;
    padding: 0.05rem 0.2rem;
  }

  .tabs-container {
    margin-top: 1rem;
  }
}

@media (max-width: 480px) {
  .tab-btn {
    padding: 0.05rem 0.2rem;
  }
}
</style>
{% endblock %}
