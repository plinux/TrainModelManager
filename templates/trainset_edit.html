{% extends "base.html" %}
{% from "macros/form.html" import select_field, text_field, date_field, price_field, scale_select, boolean_select, number_field %}

{% block title %}编辑动车组模型 - 火车模型管理系统{% endblock %}

{% block content %}
<h1>编辑动车组模型</h1>

<form id="trainset-form" method="POST">
  <div class="form-row">
    {{ select_field('model_id', '型号', trainset_models, required=true, value=trainset.model_id, onchange='autoFillTrainset()') }}
    {{ select_field('series_id', '系列', trainset_series, value=trainset.series_id, onchange='handleTrainsetSeriesChange()') }}
    {{ select_field('power_type_id', '动力类型', power_types, value=trainset.power_type_id) }}
    {{ select_field('depot_id', '动车段', depots, value=trainset.depot_id) }}
    {{ scale_select(value=trainset.scale) }}
    {{ select_field('brand_id', '品牌', brands, required=true, value=trainset.brand_id) }}
  </div>

  <div class="form-row">
    {{ text_field('trainset_number', '动车号', required=true, value=trainset.trainset_number) }}
    {{ text_field('decoder_number', '编号', value=trainset.decoder_number) }}
    {{ text_field('plaque', '挂牌', value=trainset.plaque) }}
    {{ text_field('color', '颜色', value=trainset.color) }}
    {{ number_field('formation', '编组数', value=trainset.formation) }}
  </div>

  <div class="form-row">
    {{ boolean_select('head_light', '头车灯', value=trainset.head_light) }}
    {{ text_field('interior_light', '室内灯', value=trainset.interior_light) }}
    {{ select_field('chip_interface_id', '芯片接口', chip_interfaces, value=trainset.chip_interface_id) }}
    {{ select_field('chip_model_id', '芯片型号', chip_models, value=trainset.chip_model_id) }}
  </div>

  <div class="form-row">
    {{ text_field('item_number', '货号', value=trainset.item_number) }}
    {{ price_field(value=trainset.price) }}
    {{ select_field('merchant_id', '购买商家', merchants, value=trainset.merchant_id) }}
    {{ date_field('purchase_date', '购买日期', value=trainset.purchase_date) }}
  </div>

  <button type="submit">保存</button>
  <a href="{{ url_for('trainset.trainset') }}" class="btn-cancel">取消</a>
</form>

{% if errors %}
<div class="error">
  {% for error in errors %}
  <p>{{ error }}</p>
  {% endfor %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  window.trainsetSeriesData = [
    {% for series in trainset_series %}
    { id: {{ series.id }}, name: '{{ series.name }}' }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
  window.trainsetModelData = [
    {% for model in trainset_models %}
    { id: {{ model.id }}, name: '{{ model.name }}', series_id: {{ model.series_id or 'null' }}, power_type_id: {{ model.power_type_id or 'null' }} }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
</script>
{% endblock %}
